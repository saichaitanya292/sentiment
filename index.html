<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Multilingual Sentiment Analyzer + URL Review Analyzer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="min-h-screen bg-slate-100 flex items-center justify-center px-4">

  <div class="max-w-3xl w-full bg-white rounded-2xl shadow-xl p-6 sm:p-8 space-y-8">
    
    <!-- HEADER -->
    <div class="space-y-1">
      <h1 class="text-3xl font-bold text-slate-900">Multilingual Sentiment Analyzer</h1>
      <p class="text-sm text-slate-500">Analyze text OR an entire webpage reviews (URL). Supports 100+ languages.</p>
    </div>


    <!-- TEXT ANALYZER -->
    <div>
      <h2 class="text-xl font-semibold text-slate-800 mb-2">Text Analyzer</h2>

      <div class="space-y-2">
        <textarea id="inputText" rows="4"
          class="w-full rounded-xl border border-slate-300 px-3 py-2 text-sm shadow-sm focus:ring-2 focus:ring-indigo-500"
          placeholder="Type or speak your sentence..."></textarea>

        <!-- Mic Button -->
        <button id="voiceBtn"
          class="rounded-full border border-slate-300 bg-white p-2 text-slate-700 hover:bg-slate-50">
          ðŸŽ¤
        </button>

        <button id="analyzeBtn"
          class="mt-2 w-full bg-indigo-600 text-white px-4 py-2 rounded-xl font-semibold hover:bg-indigo-700">
          Analyze Sentiment
        </button>

        <p id="helper" class="text-xs text-slate-400">
          Click the mic to speak. Works best in Chrome/Edge.
        </p>
      </div>

      <!-- RESULT -->
      <div class="mt-4">
        <h3 class="font-medium text-slate-700">Result:</h3>
        <pre id="output"
          class="mt-1 max-h-52 overflow-auto rounded-xl bg-slate-900 text-xs text-slate-100 p-3 border border-slate-700"></pre>
      </div>
    </div>



    <!-- URL ANALYZER -->
    <div>
      <h2 class="text-xl font-semibold text-slate-800 mb-2">Analyze Reviews from URL</h2>

      <div class="space-y-2">
        <div class="flex flex-col sm:flex-row gap-2">
          <input id="urlInput"
            class="w-full rounded-xl border border-slate-300 px-3 py-2 text-sm shadow-sm"
            placeholder="https://saichaitanya292.github.io/appwebsite/" />

          <button id="urlBtn"
            class="rounded-xl bg-slate-800 px-4 py-2 text-sm font-semibold text-slate-100 hover:bg-slate-700">
            Analyze URL
          </button>
        </div>

        <p class="text-xs text-slate-400">
          Only use pages you own or are allowed to analyze (your own product/review pages).
        </p>

        <pre id="urlOutput"
          class="mt-2 max-h-52 overflow-auto rounded-xl bg-slate-900 text-xs text-slate-100 p-3 border border-slate-700"></pre>
      </div>
    </div>



    <!-- FOOTER -->
    <div class="pt-4 border-t text-xs text-slate-500">
      Backend: Hugging Face Spaces (Bandlaguda/senti-api) Â· Frontend: Tailwind + JS
    </div>

  </div>




  <!-- MAIN SCRIPT -->
  <script type="module">
    import { Client } from "https://esm.sh/@gradio/client";

    const clientPromise = Client.connect("Bandlaguda/senti-api");

    const inputEl = document.getElementById("inputText");
    const outputEl = document.getElementById("output");
    const analyzeBtn = document.getElementById("analyzeBtn");

    /* ---------------- TEXT ANALYZER ---------------- */
    async function analyzeText() {
      const text = inputEl.value.trim();
      if (!text) {
        outputEl.textContent = "Please enter some text.";
        return;
      }

      outputEl.textContent = "Analyzingâ€¦";

      try {
        const client = await clientPromise;
        const result = await client.predict("/analyze", { text });

        const sentiment = result.data?.[0] ?? "";
        const confidence = result.data?.[1] ?? 0;

        outputEl.textContent =
          "Sentiment: " + sentiment + "\nConfidence: " + (confidence * 100).toFixed(1) + "%";
      } catch (err) {
        outputEl.textContent = "Error: " + err;
      }
    }

    analyzeBtn.addEventListener("click", analyzeText);



    /* ---------------- VOICE INPUT ---------------- */
    const voiceBtn = document.getElementById("voiceBtn");
    const helper = document.getElementById("helper");

    let recognition = null;
    let listening = false;

    function initSpeech() {
      const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
      if (!SR) {
        helper.textContent = "Voice input not supported in this browser.";
        voiceBtn.disabled = true;
        return;
      }

      recognition = new SR();
      recognition.lang = "en-US";
      recognition.interimResults = false;

      recognition.onstart = () => {
        listening = true;
        voiceBtn.textContent = "ðŸ›‘";
        helper.textContent = "Listeningâ€¦";
      };

      recognition.onend = () => {
        listening = false;
        voiceBtn.textContent = "ðŸŽ¤";
        helper.textContent = "Click the mic to speak.";
      };

      recognition.onresult = (event) => {
        const transcript = event.results[0][0].transcript;
        inputEl.value += (inputEl.value ? " " : "") + transcript;
      };
    }

    initSpeech();

    voiceBtn.addEventListener("click", () => {
      if (!recognition) return;
      if (!listening) recognition.start();
      else recognition.stop();
    });



    /* ---------------- URL ANALYZER ---------------- */
    const urlInput = document.getElementById("urlInput");
    const urlBtn = document.getElementById("urlBtn");
    const urlOutput = document.getElementById("urlOutput");

    urlBtn.addEventListener("click", async () => {
      const url = urlInput.value.trim();
      if (!url) {
        urlOutput.textContent = "Please enter a URL.";
        return;
      }

      urlOutput.textContent = "Fetching reviewsâ€¦";
      urlBtn.disabled = true;

      try {
        const client = await clientPromise;

        // MUST match api_name="analyze_url" from your app.py
        const result = await client.predict("/analyze_url", { url });

        const summary = result.data?.[0] ?? "";
        const details = result.data?.[1] ?? {};

        urlOutput.textContent =
          summary + "\n\nDetails:\n" + JSON.stringify(details, null, 2);
      } catch (err) {
        urlOutput.textContent = "Error: " + err;
      }

      urlBtn.disabled = false;
    });

  </script>

</body>
</html>
